---
tags:
  - 用語
---

# CFG

CFGとはControl Flow Graphの略で, 日本語では制御フローグラフと呼ばれます. 
具体的には, プログラムの制御フローを有向グラフの形式で表したものです. 

CFGにおいて, 頂点は連続した命令列である基本ブロックを表し, 接続関係は基本ブロックの間の実行順序を表します. 
また, CFGは関数の単位で構築され関数間の呼び出し関係は扱いません. 

![CFGの例](../img/cfg_example.png)

## 基本ブロック(Basic Block)

CFGにおけるノードは**基本ブロック(Basic Block)**[^1]と呼ばれます. 
基本ブロックは, プログラムから切り出された連続した命令列であり, 以下の条件を満たすものを指します. 

- 入辺が単一
- 出辺が単一
- ブロックの最初の命令(入口)と最後の命令の間(出口)で, ブロックの外部への遷移が存在しない
- 入口と出口の間で外部のブロックからの遷移が存在しない
- 以上の条件を満たす最大の連続した命令列である

直感的に表現すれば, 途中に分岐や合流のない命令列のことです. 

[^1]:BBと略されることが多い印象があります

## CFGの構築

命令列からCFGを構築するには大まかに以下のような手順が取られることが多い印象です. 

1. 命令列全体からジャンプ先に指定されるような基本ブロックの入口足りえる命令を収集する. 
2. 収集した命令の集合を元に, 各基本ブロックの出口を特定し, 基本ブロックを構築し, 頂点集合とする. 
3. 基本ブロック間の繊維関係をエッジとして貼る. 

以下に手順を簡単に動画で示します. 

<video controls playsinline preload="metadata" style="width:100%; ">
  <source src="../video/cfg_construction.mp4" type="video/mp4">
  お使いのブラウザは video タグに対応していません。
</video>
